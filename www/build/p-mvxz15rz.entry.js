import{r as i,h as e}from"./p-ea61ee30.js";import{e as t}from"./p-1173ef90.js";const s=class{constructor(e){i(this,e),this.council=!1,this.webmaps=[],this.maps=[],this.councilInfo=[],this.features=[]}initializeMap(){t(["esri/portal/Portal","esri/widgets/Search","esri/WebMap","esri/layers/FeatureLayer","esri/tasks/Locator"]).then(([i,e,t,s,r])=>{this.search=new e({container:"searchDiv",includeDefaultSources:!1,sources:[{locator:new r({url:"https://maps.raleighnc.gov/arcgis/rest/services/Locators/FindMyService/GeocodeServer"}),placeholder:"Search by address"}]}),this.search.on("select-result",i=>{this.maps=[];let e=[];this.councilInfo=[],new s({url:"https://maps.raleighnc.gov/arcgis/rest/services/Planning/Jurisdictions/MapServer/0"}).queryFeatureCount({geometry:i.result.feature.geometry,outFields:["*"],where:"LONG_NAME = 'RALEIGH'"}).then(t=>{this.webmaps.forEach(s=>{if(s.portalItem.title.includes("Leaf")&&0===t)console.log("Leaf collection not available outside city limits");else{let t=0,r=[];this.layers&&(r=this.layers.split(","));let l=[];s.layers.forEach(a=>{(0===r.length||r.includes(a.title))&&a.queryFeatures({geometry:i.result.feature.geometry,outFields:["*"]}).then(i=>{l=[...l,{title:a.title,features:i.features,id:a.id}],t+=i.features.length,this.council&&a.title.includes("City Council")&&i.features.length>0&&(console.log(i.features[0]),i.features[0].useDefaultPopupTemplate=!1,i.features[0].layer.popupTemplate.content[0].text='<div style="padding:30px"><img alt="" src="{expression/expr0}" style="padding-right:1em;max-height:200px;"/>',i.features[0].layer.popupTemplate.content[0].text+="<h5>{COUNCIL_PERSON}</h5><span>Raleigh City Council</span><div>District {COUNCIL_DIST}</div><div><a href='https://www.raleighnc.gov/services/government/city-council-and-committees'><span>Website </span></a></div></div>",i.features[0].layer.popupTemplate.title="",this.councilInfo.push(i.features[0])),l.length!==s.layers.length&&r.length!==l.length||(l.sort((i,e)=>i.title<e.title?-1:i.title>e.title?0:void 0),e=[...e,{title:s.portalItem.title,featureCnt:t,layers:l}]),e.length===this.webmaps.length&&(e.sort((i,e)=>i.title<e.title?-1:i.title>e.title?0:void 0),this.maps=[...e])})})}})})});const l=new i;l.load().then(()=>{let i={query:"id: a8acaca3d4514d40bc7f302a8db291fb",sortField:"title"};l.queryGroups(i).then(e=>{if(e.results.length){i={query:"type: map",sortField:"title"};let s=[];this.categories&&(s=this.categories.split(",")),e.results[0].queryItems(i).then(i=>{i.results.length&&i.results.forEach(e=>{console.log(s),(0===s.length||s.includes(e.title))&&new t({portalItem:{id:e.id}}).loadAll().then(e=>{e.layers.items.forEach(i=>{i.features=[]}),e.featureCnt=0,this.webmaps.push(e),this.webmaps.length===i.results.length&&(this.webmaps=[...this.webmaps])})})})}})})})}componentDidLoad(){this.webmaps=[],this.initializeMap()}componentWillLoad(){this.search&&this.search.destroy(),document.getElementById("searchDiv")&&(document.getElementById("searchDiv").innerHTML=""),this.maps=[]}loadFeatureWidget(i,e){t(["esri/widgets/Feature"]).then(([t])=>{setTimeout(()=>{new t({container:i}).graphic=e},200)})}disconnectedCallback(){document.getElementById("councilDiv").innerHTML=""}render(){return e("div",null,e("div",{id:"searchDiv"}),this.council?e("div",{class:"o-layout-sidebar-after o-layout-sidebar-after--tight"},this.councilInfo.map(i=>e("div",{id:"councilDiv",class:"o-layout-sidebar-after__secondary"},this.loadFeatureWidget("councilDiv",i))),e("ol",{class:"o-layout-grid o-layout-grid--3 o-layout-sidebar-after__primary"},this.maps.map(i=>i.featureCnt>0?e("li",{class:"o-layout-grid__item"},e("div",null,e("h3",null,i.title),i.layers.map(i=>i.features.length>0?e("div",null,i.features.map((t,s)=>this.council&&i.title.includes("City Council")?e("div",null):e("div",{id:i.id+"_"+s},this.loadFeatureWidget(i.id+"_"+s,t),e("br",null)))):e("div",null)))):e("div",null,"Services not provided for this address")))):e("div",null,e("ol",{class:"o-layout-grid o-layout-grid--3"},this.maps.map(i=>e("li",{class:"o-layout-grid__item"},e("div",null,e("h3",null,i.title),i.layers.map(i=>i.features.length>0?e("div",null,i.features.map((t,s)=>e("div",{id:i.id+"_"+s},this.loadFeatureWidget(i.id+"_"+s,t),e("br",null)))):e("div",{class:"esri-feature esri-widget"},e("br",null),e("h4",{class:"esri-feature__title"},i.title),e("div",{class:"esri-feature__text esri-feature__content-element"},e("div",{class:"esri-feature__main-container"},"Service not provided for this address"))))))))))}static get style(){return"\@import url(\"https://js.arcgis.com/4.13/esri/themes/light/main.css\");"}};export{s as find_my_service};